!function(){"use strict";var e=window.wp.plugins,t=window.wp.element,n=window.wp.editPost,r=window.wp.components;var o=window.wp.data;(0,e.registerPlugin)("headless-plugin",{icon:()=>null,render:function(){const{state:e,reload:s}=(()=>{const[e,n]=(0,t.useState)("idle"),r=(0,o.useSelect)((e=>e("core/editor").getCurrentPost()));return{state:e,reload:()=>{n("loading"),fetch((e=>window.Headless.ajax+"?action="+window.Headless.actions.reload+"&post="+e)(r.id)).then((e=>e.json())).then((e=>{e.success?n("success"):(console.error(e),n("error"))})).catch((()=>{n("error")})).finally((()=>{setTimeout((()=>{n("idle")}),4e3)}))}}})();return(0,t.createElement)(n.PluginDocumentSettingPanel,{title:"Headless"},(0,t.createElement)(r.Button,{variant:"secondary",disabled:"idle"!=e,onClick:s},"Reload cache"),"idle"==e&&(0,t.createElement)("p",{className:"description"},"Reload contents in headless frontend."),"loading"==e&&(0,t.createElement)("p",null,"Loading..."),"success"==e&&(0,t.createElement)("p",null,"ðŸŽ‰ Success"),"error"==e&&(0,t.createElement)("p",null,"ðŸš¨ Something went wrong"))}}),document.addEventListener("DOMContentLoaded",(function(){const e=(0,o.select)("core/editor"),t=e.getCurrentPostId,n=e.isSavingPost,r=(0,o.dispatch)("core/editor"),s=r.autosave,a=r.savePost,i=document.createElement("a");i.className="components-button",i.addEventListener("click",(t=>{t.preventDefault(),n()||((()=>{const t=e.getCurrentPost().status;return"draft"==t||"auto-draft"==t})()?a:s)().then((()=>{window.open(i.href,i.target)}))})),(0,o.subscribe)((()=>{n()?i.classList.add("is-disabled"):i.classList.remove("is-disabled")})),setInterval((function(){const e=(e=>window.Headless.preview_url.replace(window.Headless.post_id_placeholder,`${e}`))(t()),n=document.querySelectorAll("[target^=wp-preview-]");n&&n.length&&n.forEach((t=>{t.setAttribute("href",e)}));const r=c.querySelector(".edit-post-post-preview-dropdown .components-menu-group:has(.edit-post-header-preview__grouping-external)");if(!r)return;const o="headless-preview-link";if(r.querySelector("#"+o))return;const s=r.querySelector(".edit-post-header-preview__grouping-external a"),a=s.getAttribute("target");i.text=s.textContent;const d=document.createElement("span");d.className="dashicons dashicons-external",i.append(d),i.target=a,i.href=e,i.id=o,r.querySelector('[role="group"]').append(i)}),300);const c=document.querySelector("#editor")}))}();