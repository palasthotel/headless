{"version":3,"file":"gutenberg.js","mappings":"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","sources":["webpack://@palasthotel/wp-headless/./src/components/ReloadPanel.tsx","webpack://@palasthotel/wp-headless/./src/hooks/use-reload.ts","webpack://@palasthotel/wp-headless/./src/preview.ts","webpack://@palasthotel/wp-headless/./src/store/window.ts","webpack://@palasthotel/wp-headless/./src/styles.css?61ee","webpack://@palasthotel/wp-headless/external window \"React\"","webpack://@palasthotel/wp-headless/external window [\"wp\",\"components\"]","webpack://@palasthotel/wp-headless/external window [\"wp\",\"data\"]","webpack://@palasthotel/wp-headless/external window [\"wp\",\"editPost\"]","webpack://@palasthotel/wp-headless/external window [\"wp\",\"element\"]","webpack://@palasthotel/wp-headless/external window [\"wp\",\"plugins\"]","webpack://@palasthotel/wp-headless/webpack/bootstrap","webpack://@palasthotel/wp-headless/webpack/runtime/compat get default export","webpack://@palasthotel/wp-headless/webpack/runtime/define property getters","webpack://@palasthotel/wp-headless/webpack/runtime/hasOwnProperty shorthand","webpack://@palasthotel/wp-headless/webpack/runtime/make namespace object","webpack://@palasthotel/wp-headless/./src/gutenberg.ts"],"sourcesContent":["import {PluginDocumentSettingPanel} from '@wordpress/edit-post';\nimport {Button} from \"@wordpress/components\";\nimport {useReload, State, useCanRevalidate, usePost} from \"../hooks/use-reload\";\nimport {getFrontends} from \"../store/window\";\nimport {useEffect, useMemo, useState} from \"@wordpress/element\";\n\ntype Controller = {\n    add: (frontend: number, fn: () => void) => void\n    run: () => void\n}\n\nconst buildController = (): Controller => {\n    const fns = new Map<number, ()=>void>();\n    return {\n        add: (frontend, fn) => {\n            fns.set(frontend, fn);\n        },\n        run: () => {\n            fns.forEach((fn) => {\n                fn();\n            });\n        }\n    }\n}\n\ntype FrontendProps = {\n    index: number\n    baseUrl: string\n    controller: Controller,\n    onStateChanged: (frontend: number, state: State) => void\n}\nconst FrontendItem = (\n    {\n        index,\n        baseUrl,\n        controller,\n        onStateChanged,\n    }: FrontendProps\n) => {\n    const {\n        state,\n        reload,\n    } = useReload(index);\n\n    const post = usePost();\n\n    const url = useMemo(()=>{\n        const link = post.link;\n        const url = new URL(link);;\n        return baseUrl.replace(/^\\/|\\/$/g, '')+url.pathname;\n    }, [post.link])\n\n    useEffect(() => {\n        controller.add(index, reload);\n    }, [index]);\n\n    useEffect(() => {\n        onStateChanged(index, state);\n    }, [state])\n\n    return <div title={url}>\n        <a href={url} target=\"_blank\">Frontend {index}</a>\n        {state == \"loading\" && <> 🧹</>}\n        {state == \"success\" && <> ✅</>}\n        {state == \"error\" && <> 🚨</>}\n    </div>\n}\n\nexport default function ReloadPanel() {\n\n    const frontends = getFrontends();\n\n    const controller = useMemo(() => buildController(), []);\n    const [loadingState, setLoadingState] = useState<{ [key: number]: boolean}>({});\n    const canRevalidate = useCanRevalidate();\n\n    const handleClick = () => {\n        controller.run();\n    }\n\n    const isLoading = Object.values(loadingState).find(value => value == true);\n\n    return (\n        <PluginDocumentSettingPanel\n            title=\"Headless\"\n        >\n            {canRevalidate ?\n                <>\n                    <ol>\n\n                        {frontends.map((frontend, index) => {\n                            return <li key={index}>\n                                <FrontendItem\n                                    baseUrl={frontend}\n                                    index={index}\n                                    controller={controller}\n                                    onStateChanged={(index, state) => {\n                                        setLoadingState(prev => {\n                                            const copy = {...prev};\n                                            copy[index] = state  == \"loading\";\n                                            return copy;\n                                        });\n                                    }}\n                                />\n                            </li>\n                        })}\n                    </ol>\n\n                    <Button\n                        variant=\"secondary\"\n                        disabled={isLoading || !canRevalidate}\n                        onClick={handleClick}\n                    >\n                        Revalidate cache\n                    </Button>\n                </>\n                :\n                <p className=\"description\">Only published contents can be revalidated.</p>\n            }\n\n\n        </PluginDocumentSettingPanel>\n    )\n}\n","import {getReloadAjaxUrl} from \"../store/window\";\nimport {useSelect} from '@wordpress/data';\nimport {useMemo, useState} from \"@wordpress/element\";\n\nexport type State = \"idle\" | \"loading\" | \"success\" | \"error\"\n\n\ntype Post = {\n    id: number\n    link: string\n    status: string\n}\n\nexport const usePost = (): Post|undefined => {\n    return useSelect<Post>(\n        select => select(\"core/editor\").getCurrentPost(),\n        []\n    );\n}\n\nexport const useCanRevalidate = ()=> {\n    return usePost().status == \"publish\";\n}\n\n\nexport const useReload = (frontend:number) => {\n\n    const [state, setState] = useState<State>(\"idle\");\n    const post = usePost();\n\n    const path = useMemo(()=>{\n        if(post?.link){\n            const url = new URL(post?.link);\n            return url.pathname;\n        } else {\n            return \"\";\n        }\n    }, [post.link]);\n\n    return {\n        state,\n        reload: () => {\n            setState(\"loading\");\n            (async ()=>{\n                try {\n                    const response = await fetch(getReloadAjaxUrl(frontend, path));\n                    const json = await response.json()\n                    if(json.success){\n                        setState(\"success\");\n                    } else {\n                        console.error(json);\n                        setState(\"error\");\n                    }\n                } catch(e) {\n                    setState(\"error\");\n                }\n\n            })();\n        }\n    }\n}\n","\nexport function writeInterstitialMessage( targetDocument: Document ) {\n\n    let markup = ''\n\n    markup += `\n\t\t<style>\n\t\t\tbody {\n\t\t\t\tmargin: 0;\n\t\t\t}\n\t\t\t.editor-post-preview-button__interstitial-message {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\theight: 100vh;\n\t\t\t\twidth: 100vw;\n\t\t\t}\n\t\t\t@-webkit-keyframes paint {\n\t\t\t\t0% {\n\t\t\t\t\tstroke-dashoffset: 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t@-moz-keyframes paint {\n\t\t\t\t0% {\n\t\t\t\t\tstroke-dashoffset: 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t@-o-keyframes paint {\n\t\t\t\t0% {\n\t\t\t\t\tstroke-dashoffset: 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t@keyframes paint {\n\t\t\t\t0% {\n\t\t\t\t\tstroke-dashoffset: 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.editor-post-preview-button__interstitial-message svg {\n\t\t\t\twidth: 192px;\n\t\t\t\theight: 192px;\n\t\t\t\tstroke: #555d66;\n\t\t\t\tstroke-width: 0.75;\n\t\t\t}\n\t\t\t.editor-post-preview-button__interstitial-message svg .outer,\n\t\t\t.editor-post-preview-button__interstitial-message svg .inner {\n\t\t\t\tstroke-dasharray: 280;\n\t\t\t\tstroke-dashoffset: 280;\n\t\t\t\t-webkit-animation: paint 1.5s ease infinite alternate;\n\t\t\t\t-moz-animation: paint 1.5s ease infinite alternate;\n\t\t\t\t-o-animation: paint 1.5s ease infinite alternate;\n\t\t\t\tanimation: paint 1.5s ease infinite alternate;\n\t\t\t}\n\t\t\tp {\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif;\n\t\t\t}\n\t\t</style>\n\t`;\n\n    markup += `\n        <div class=\"editor-post-preview-button__interstitial-message\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 96 96\">\n                <path class=\"outer\" d=\"M48 12c19.9 0 36 16.1 36 36S67.9 84 48 84 12 67.9 12 48s16.1-36 36-36\" fill=\"none\" />\n                <path class=\"inner\" d=\"M69.5 46.4c0-3.9-1.4-6.7-2.6-8.8-1.6-2.6-3.1-4.9-3.1-7.5 0-2.9 2.2-5.7 5.4-5.7h.4C63.9 19.2 56.4 16 48 16c-11.2 0-21 5.7-26.7 14.4h2.1c3.3 0 8.5-.4 8.5-.4 1.7-.1 1.9 2.4.2 2.6 0 0-1.7.2-3.7.3L40 67.5l7-20.9L42 33c-1.7-.1-3.3-.3-3.3-.3-1.7-.1-1.5-2.7.2-2.6 0 0 5.3.4 8.4.4 3.3 0 8.5-.4 8.5-.4 1.7-.1 1.9 2.4.2 2.6 0 0-1.7.2-3.7.3l11.5 34.3 3.3-10.4c1.6-4.5 2.4-7.8 2.4-10.5zM16.1 48c0 12.6 7.3 23.5 18 28.7L18.8 35c-1.7 4-2.7 8.4-2.7 13zm32.5 2.8L39 78.6c2.9.8 5.9 1.3 9 1.3 3.7 0 7.3-.6 10.6-1.8-.1-.1-.2-.3-.2-.4l-9.8-26.9zM76.2 36c0 3.2-.6 6.9-2.4 11.4L64 75.6c9.5-5.5 15.9-15.8 15.9-27.6 0-5.5-1.4-10.8-3.9-15.3.1 1 .2 2.1.2 3.3z\" fill=\"none\" />\n            </svg>\n            <p>Generating preview…</p>\n        </div>\n    `;\n\n    targetDocument.write( markup );\n    targetDocument.close();\n}\n","declare global {\n    interface Window {\n        Headless: {\n            ajax: string\n            frontends: string[]\n            actions: {\n                revalidate: string\n            }\n            post_id_placeholder: string\n            preview_url: string\n        }\n    }\n}\n\nexport const getAjaxUrl = ()=> window.Headless.ajax;\nexport const getReloadAjaxUrl = (frontend: number, path: string) =>\n    getAjaxUrl()+`?action=${window.Headless.actions.revalidate}&frontend=${frontend}&path=${path}`;\n\nexport const getPreviewUrl = (postId: number) => {\n    return window.Headless.preview_url.replace(window.Headless.post_id_placeholder, `${postId}`)\n};\n\nexport const getFrontends = () => window.Headless.frontends;\n","// extracted by mini-css-extract-plugin\nexport {};","module.exports = window[\"React\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"editPost\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"plugins\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {registerPlugin} from \"@wordpress/plugins\";\nimport ReloadPanel from \"./components/ReloadPanel\";\nimport {getPreviewUrl} from \"./store/window\";\nimport {select, dispatch, subscribe} from \"@wordpress/data\";\nimport {writeInterstitialMessage} from \"./preview\";\n\nimport \"./styles.css\"\n\nregisterPlugin('headless-plugin', {\n    icon: () => null,\n    render: ReloadPanel,\n});\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n\n    const coreEditorSelect = select(\"core/editor\");\n    const getCurrentPostId = coreEditorSelect.getCurrentPostId;\n    const isSavingPost = coreEditorSelect.isSavingPost;\n    const isDraft = ()=> {\n        const status = coreEditorSelect.getCurrentPost().status;\n        return status == \"draft\" || status == \"auto-draft\";\n    }\n\n    const coreEditorDispatch = dispatch(\"core/editor\");\n    const autosave = coreEditorDispatch.autosave;\n    const savePost = coreEditorDispatch.savePost;\n\n    // --------------------------------------------------------\n    // create replacement for preview link\n    // --------------------------------------------------------\n    const a = document.createElement(\"a\");\n    a.className = \"components-button\";\n\n    a.addEventListener('click', (e)=>{\n        e.preventDefault();\n        if(isSavingPost()){\n            return;\n        }\n        const ref = window.open('about:blank', a.target);\n        writeInterstitialMessage(ref.document);\n\n        const saveFn = (isDraft()) ? savePost : autosave;\n        saveFn().then(()=>{\n            ref.location = a.href;\n        });\n\n    });\n\n    subscribe(()=>{\n        if(isSavingPost()){\n            a.classList.add(\"is-disabled\");\n        } else {\n            a.classList.remove(\"is-disabled\");\n        }\n    });\n\n    // --------------------------------------------------------\n    // hack it with interval updates\n    // --------------------------------------------------------\n    // workaround script until there's an official solution for https://github.com/WordPress/gutenberg/issues/13998\n    setInterval(checkPreview, 300);\n\n    function checkPreview() {\n        const postId = getCurrentPostId();\n        const previewUrl = getPreviewUrl(postId);\n\n        // replace all preview links\n        const editorPreviewLink = document.querySelectorAll(\"[target^=wp-preview-]\");\n        if(editorPreviewLink && editorPreviewLink.length){\n            editorPreviewLink.forEach(link => {\n                link.setAttribute(\"href\", previewUrl);\n            });\n        }\n\n        // replace notice link\n        const notices =  document.querySelectorAll<HTMLAnchorElement>(\".components-snackbar-list .components-snackbar__content a.components-button\");\n        notices.forEach((notice) => {\n            if(\n                notice.href.includes(\"?post=\"+postId) // custom post types\n                ||\n                notice.href.includes(\"?page_id=\"+postId) // pages\n                ||\n                notice.href.includes(\"?p=\"+postId) // posts\n            ){\n                notice.href = previewUrl;\n                notice.target = \"wp-preview-\"+postId;\n            }\n        });\n\n        // replace this special preview link\n        const previewGroups = document.querySelectorAll(\".edit-post-post-preview-dropdown .components-menu-group\");\n        let externalPreviewGroup: null|Element = null\n        previewGroups.forEach((group)=>{\n            if(group.querySelector(\".edit-post-header-preview__grouping-external\")){\n                externalPreviewGroup = group;\n            }\n        })\n\n        if(!externalPreviewGroup){\n            return;\n        }\n\n        const id = \"headless-preview-link\";\n        if(externalPreviewGroup.querySelector(\"#\"+id)){\n            return;\n        }\n\n        // is hidden via styles.css\n        const gutenbergLink = externalPreviewGroup.querySelector(\".edit-post-header-preview__grouping-external a\");\n        const target = gutenbergLink.getAttribute(\"target\");\n        a.text = gutenbergLink.textContent;\n        const icon = document.createElement(\"span\");\n        icon.className = \"dashicons dashicons-external\";\n        a.append(icon);\n        a.target = target;\n        a.href = previewUrl;\n        a.id = id;\n        externalPreviewGroup.querySelector('[role=\"group\"]').append(a);\n    }\n});\n"],"names":["PluginDocumentSettingPanel","Button","useReload","useCanRevalidate","usePost","getFrontends","useEffect","useMemo","useState","buildController","fns","Map","add","frontend","fn","set","run","forEach","FrontendItem","index","baseUrl","controller","onStateChanged","state","reload","post","url","link","URL","replace","pathname","createElement","title","href","target","Fragment","ReloadPanel","frontends","loadingState","setLoadingState","canRevalidate","handleClick","isLoading","Object","values","find","value","map","key","prev","copy","variant","disabled","onClick","className","getReloadAjaxUrl","useSelect","select","getCurrentPost","status","setState","path","response","fetch","json","success","console","error","e","writeInterstitialMessage","targetDocument","markup","write","close","getAjaxUrl","window","Headless","ajax","actions","revalidate","getPreviewUrl","postId","preview_url","post_id_placeholder","registerPlugin","dispatch","subscribe","icon","render","document","addEventListener","coreEditorSelect","getCurrentPostId","isSavingPost","isDraft","coreEditorDispatch","autosave","savePost","a","preventDefault","ref","open","saveFn","then","location","classList","remove","setInterval","checkPreview","previewUrl","editorPreviewLink","querySelectorAll","length","setAttribute","notices","notice","includes","previewGroups","externalPreviewGroup","group","querySelector","id","gutenbergLink","getAttribute","text","textContent","append"],"sourceRoot":""}